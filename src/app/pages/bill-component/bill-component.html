<div class="bill-container">
  <!-- Header -->
  <div class="header-section">
    <div class="title-section">
      <mat-icon class="header-icon">receipt_long</mat-icon>
      <div>
        <h1>Gestión de Facturas</h1>
        <p class="subtitle">Administra todas las facturas del hotel</p>
      </div>
    </div>
    <button mat-raised-button color="primary" (click)="openDialog()" class="add-button">
      <mat-icon>add</mat-icon>
      Nueva Factura
    </button>
  </div>

  <!-- Stats Cards -->
  <div class="stats-container">
    <div class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon total">receipt</mat-icon>
        <div class="stat-info">
          <span class="stat-label">Total Facturas</span>
          <span class="stat-value">{{ filteredBills.length }}</span>
        </div>
      </div>
    </div>

    <div class="stat-card">
      <div class="stat-content">
        <mat-icon class="stat-icon amount">attach_money</mat-icon>
        <div class="stat-info">
          <span class="stat-label">Monto Total</span>
          <span class="stat-value">S/ {{ getTotalAmount() | number:'1.2-2' }}</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters-card">
    <div class="filters-container">
      <mat-form-field appearance="outline" class="search-field">
        <mat-label>Buscar factura</mat-label>
        <input matInput 
               [value]="searchTerm" 
               (input)="onSearchChange($any($event.target).value)"
               placeholder="Por ID, cliente o monto">
        <mat-icon matPrefix>search</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Estado</mat-label>
        <mat-select [value]="filterState" (selectionChange)="onFilterStateChange($event.value)">
          <mat-option value="all">Todos</mat-option>
          <mat-option value="Pagada">Pagada</mat-option>
          <mat-option value="Pendiente">Pendiente</mat-option>
          <mat-option value="Anulada">Anulada</mat-option>
        </mat-select>
        <mat-icon matPrefix>flag</mat-icon>
      </mat-form-field>

      <mat-form-field appearance="outline" class="filter-field">
        <mat-label>Método de Pago</mat-label>
        <mat-select [value]="filterPaymentMethod" (selectionChange)="onFilterPaymentChange($event.value)">
          <mat-option value="all">Todos</mat-option>
          <mat-option value="Efectivo">Efectivo</mat-option>
          <mat-option value="Tarjeta">Tarjeta</mat-option>
          <mat-option value="Transferencia">Transferencia</mat-option>
          <mat-option value="Yape">Yape</mat-option>
        </mat-select>
        <mat-icon matPrefix>payment</mat-icon>
      </mat-form-field>
    </div>
  </div>

  <!-- Tabla -->
  <div class="table-card">
    <div class="table-container">
      <table mat-table [dataSource]="filteredBills" class="bills-table">
        
        <!-- ID -->
        <ng-container matColumnDef="idBill">
          <th mat-header-cell *matHeaderCellDef>ID</th>
          <td mat-cell *matCellDef="let bill">
            <span class="id-badge">#{{ bill.idBill }}</span>
          </td>
        </ng-container>

        <!-- Booking / Cliente -->
        <ng-container matColumnDef="booking">
          <th mat-header-cell *matHeaderCellDef>Reserva / Cliente</th>
          <td mat-cell *matCellDef="let bill">
            <div class="booking-info">
              <div class="booking-id">Reserva #{{ bill.booking?.idBooking || 'N/A' }}</div>
              <div class="customer-name">
                {{ bill.booking?.customer?.name || bill.booking?.customer?.fullName || 'N/A' }}
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Fecha -->
        <ng-container matColumnDef="dateEmission">
          <th mat-header-cell *matHeaderCellDef>Fecha de Emisión</th>
          <td mat-cell *matCellDef="let bill">
            <div class="date-info">
              <mat-icon class="date-icon">event</mat-icon>
              <span>{{ bill.dateEmission | date:'dd/MM/yyyy' }}</span>
            </div>
          </td>
        </ng-container>

        <!-- Total -->
        <ng-container matColumnDef="total">
          <th mat-header-cell *matHeaderCellDef>Total</th>
          <td mat-cell *matCellDef="let bill">
            <span class="amount-badge">S/ {{ bill.total | number:'1.2-2' }}</span>
          </td>
        </ng-container>

        <!-- Método Pago -->
        <ng-container matColumnDef="paymentMethod">
          <th mat-header-cell *matHeaderCellDef>Método de Pago</th>
          <td mat-cell *matCellDef="let bill">
            <span class="payment-chip">
              <mat-icon class="chip-icon">{{ getPaymentIcon(bill.paymentMethod) }}</mat-icon>
              {{ bill.paymentMethod }}
            </span>
          </td>
        </ng-container>

        <!-- Estado -->
        <ng-container matColumnDef="state">
          <th mat-header-cell *matHeaderCellDef>Estado</th>
          <td mat-cell *matCellDef="let bill">
            <span [class]="'state-chip ' + bill.state?.toLowerCase()">
              {{ bill.state }}
            </span>
          </td>
        </ng-container>

        <!-- Acciones -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acciones</th>
          <td mat-cell *matCellDef="let bill">
            <div class="action-buttons">
              <button mat-icon-button color="primary" (click)="openDialog(bill)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button color="warn" (click)="deleteBill(bill)">
                <mat-icon>delete</mat-icon>
              </button>
              <button mat-icon-button color="accent">
                <mat-icon>print</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div *ngIf="filteredBills.length === 0" class="empty-state">
        <mat-icon>receipt_long</mat-icon>
        <h3>No se encontraron facturas</h3>
        <p>No hay facturas que coincidan con tu búsqueda</p>
      </div>
    </div>
  </div>
</div>
